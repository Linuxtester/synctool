<!DOCTYPE html>
<html>
<head>
<title>Synctool Documentation</title>
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="stylesheet" type="text/css" href="synctool_doc.css" />
</head>
<body>

<div class="page">

<span style="float: right;">
<img src="synctool_logo.jpg" alt="logo" width="230" height="80" />
</span>

<h1>Synctool Documentation</h1>
<div class="vtab"> </div>
<div class="center">
<em>synctool by Walter de Jong &lt;walter@heiho.net&gt; (c) 2003-2011</em>
<p>
synctool comes with <strong>no warranty</strong>. synctool is
<strong>free software</strong>. synctool is distributed under terms described
in the <a href="http://www.gnu.org/licenses/gpl-2.0.html">GNU General Public
License</a>.
</p>
</div>

<div class="vtab"> </div>
<div class="line"> </div>

<h2>Table of contents</h2>
<ol>
<li><a href="#part_one">What is synctool</a></li>
<li><a href="#part_two">Installation</a>
 <ol class="subindex">
  <li><a href="#passwordless_ssh">Passwordless SSH</a></li>
  <li><a href="#make_install">make install</a></li>
  <li><a href="#config_nodes_groups">synctool configuration: nodes and
    groups</a></li>
  <li><a href="#testing_with_dsh">Testing with dsh</a></li>
  <li><a href="#your_first_synctool_run">Your first synctool run</a></li>
  <li><a href="#client_install">Client installation</a></li>
 </ol>
</li>

<li><a href="#part_three">Using synctool</a>
 <ol class="subindex">
  <li><a href="#masterdir">The masterdir</a></li>
  <li><a href="#running_synctool">Running synctool</a></li>
  <li><a href="#adding_actions_to_updates">Adding actions to updates</a></li>
  <li><a href="#special_groups">Special groups</a></li>
  <li><a href="#useful_options">Useful options</a></li>
  <li><a href="#logging">Logging</a></li>
  <li><a href="#ignoring">Ignoring them: I'm not touching you</a></li>
  <li><a href="#about_symlinks">About symbolic links</a></li>
  <li><a href="#backup_copies">Backup copies</a></li>
  <li><a href="#local_config">Node-specific local configuration
    adjustments</a></li>
  <li><a href="#checking_for_updates">Checking for updates</a></li>
  </ol>
 </li>

<li><a href="#part_four">All configuration parameters explained</a></li>
<li><a href="#part_five">Best practices</a></li>
</ol>

<div class="line"> </div>

<h2 id="part_one">1. What is synctool</h2>
<div class="chapter">
<p>
synctool is a tool that can help you administer your cluster of computers.
Its primary function is keeping configuration files &lsquo;in sync,&rsquo;
i.e.: as they ought to be. Its core business is copying configuration files
to groups (or classes) of computers within a cluster and comparing such
files with a normative copy that you keep in a repository.
The repository, by the way, is not some database system, but an
&lsquo;overlay&rsquo; directory tree in a file system, that looks very
much like the directories of the managed target systems. The only
things missing from the repository are the files and directories that you
do not <em>want</em> or need synctool to manage. In the repository, you can
manage directories with conventional <span class="smallcaps">Unix</span> tools
&ndash; <span class="cmd">cp</span>, <span class="cmd">mv</span>,
<span class="cmd">mkdir</span> &ndash;
or any tool you like, and you can edit files with the editor of preference.
</p>

<p>
There are other tools in existence that do the same thing as synctool,
and ironically, none of them are as easy to understand and use as synctool.
Perhaps this is so, because other tools try to do the same thing, among
many other things as well. synctool does <em>not</em> try to be an all
encompassing system administation tool, and does not have its own little
scripting language to define your system in. It does not strive to automate
all aspects of the system administrator's work. Rather, it focuses on
its core business only and concentrates on doing that very well.
This is very much in line with the traditional
<span class="smallcaps">Unix</span> design philosophy &mdash;
and with common sense. The powerful set of now common shell tools grew by
adding commands that were designed to do only specific tasks very well and
to be used easily in combination with other tools that specialize in other
tasks.    
</p>

<p>
Because of that design philosophy:
<ul>
<li>synctool integrates very easily into existing system adminstration
    practices as an add-on tool, specifically to do configuration file
    management. It does not interfere with other things and does not need
    much either: It is written in the <span class="cmd">Python</span> language,
    and it uses the power of <span class="cmd">rsync</span> and
    <span class="cmd">ssh</span> to distribute and check the consistency of
    files.
</li>
<li>It is possible to use synctool in the style that suits you best: Warn you
    whenever things are out of &lsquo;sync&rsquo; or do automated repairs of
    deviations. It is even possible to manage some files with synctool and
    leave other files to other mechanisms &mdash; what is not represented in
    the synctool repository is not managed by it.
</li>
<li>Although synctool has many command-line options, its set of core functions
    is very small and easy to understand. There is not that much you need to
    know to use it, so there is virtually no learning curve to get you started
    with synctool.
</li>
</ul>
</p>

<p>
In addition, synctool simplifies things by working with the following concepts:
<ul>
<li>Some clusters are more homogeneous than others. To handle differentiation
    within a cluster, a host can be part of one or more logical groups;
</li>
<li>Files are designated to a group by means of filename extension;</li>
<li>The &lsquo;overlay&rsquo; directory tree contains the files that are
    &lsquo;synced&rsquo; to the target hosts;
</li>
<li>When certain files are updated, you will want to execute a script 
    (e.g, <span class="cmd">/etc/init.d/daemon restart</span>).
    synctool has a mechanism for this. You can make synctool more powerful
    by writing plugin scripts that run the commands you want whenever
    a particular file has been updated.  
</li>
</ul>
</p>

<p>
synctool manages configuration files, not processes, and not full system
installations. However, synctool can be made to do more than just this.
synctool is extensible in the sense that it can run scripts on hosts
(via the &lsquo;tasks&rsquo; mechanism). This is primarily meant to do
synchronized updates of software packages on all systems in the cluster,
but can also be used to check daemons, or perform other system administration
tasks.
</p>

<p>
synctool does not hide <span class="smallcaps">UNIX</span> from you.
Making clever use of synctool makes it a very powerful tool.
</p>

<p>
synctool is successfully being used to administer several clusters at the
Dutch national supercomputer facility since 2003. Hopefully it will
be of some value to you as well.
</p>

</div>

<div class="vtab"> </div>
<div class="line"> </div>

<h2 id="part_two">2. Installation</h2>
<div class="chapter">
<div class="note">
In synctool terminology, a &ldquo;node&rdquo; is a host, a computer in a group
of computers. A group of computers is called a cluster.
</div>

<p>
<h3 id="passwordless_ssh">Passwordless SSH</h3>
First of all, synctool requires passwordless SSH from the master node to
each cluster node as root. Exactly how to do this is beyond the scope
of this document (see the SSH documentation or just google around), but
I'd like to say this about it:
<ul>
<li>use SSH keypairs</li>
<li>or use hostbased authentication, also for root</li>
<li>set <span class="path">sshd_config</span>
    <span class="system">PermitRootLogin without-password</span></li>
<li>run <span class="cmd">sshd</span> only the internal network interface to
    secure your system</li>
<li>in general, passwordless SSH from any cluster node to your master node
    should <em>not</em> work or be allowed; or at least, synctool does not
    need this</li>
</ul>
For sites with extra tight security, it is possible to configure ssh to run
only specific (synctool) commands, or maybe you want to change the
ssh_cmd in the configuration so that it runs a different command, that
suits your security needs.
</p>
<p>
When passwordless SSH as root works, proceed to installing the software.
</p>

<p>
<h3 id="make_install">make install</h3>
Edit the provided <span class="cmd">Makefile</span> and adjust
<span class="cmd">PREFIX</span> to point to your desired location where the
software should reside. Some prefer <span class="path">/usr/local</span>,
others prefer <span class="path">/usr/local/synctool</span>, while others
prefer <span class="path">/opt</span>. Pick whatever you think is best.
</p>

<p>
On your master node, run <span class="cmd">make install</span>. This copies
the commands to the selected location and sets up symlinks for:
<pre class="example">
synctool        -&gt; synctool_master.py
synctool-config -&gt; synctool_config.py
synctool-ping   -&gt; synctool_ping.py
dsh-ping        -&gt; synctool_ping.py
synctool-ssh    -&gt; synctool_ssh.py
dsh             -&gt; synctool_ssh.py
synctool-scp    -&gt; synctool_scp.py
dcp             -&gt; synctool_scp.py
synctool-aggr   -&gt; synctool_aggr.py
</pre>
It also creates the master repository under
<span class="path">/var/lib/synctool/</span>.
</p>

<p>
<h3 id="config_nodes_groups">synctool configuration: nodes and groups</h3>
Copy the <span class="path">synctool.conf.example</span> to
<span class="path">/var/lib/synctool/synctool.conf</span>
and edit it, adjusting it as needed. For an explanation of all configurable
parameters, see <a href="#part_four">chapter 4</a>.
</p>

<p>
<span style="path">synctool.conf</span> describes what your cluster looks like;
what nodes have what roles, and how synctool can contact them.
Think a bit about what role each machine has. There is no need to
go into great depth right now; you can always adjust the configuration
later.
<pre class="example">
node n1 ipaddress:machine-n01
</pre>
The nodename is the &ldquo;synctool name that the node has.&rdquo; It is in
general the short hostname of the host, but in fact it can be anything you
like. The nodename has nothing to do with hostnames or DNS entries.
The <span class="system">ipaddress</span> specifier tells synctool how to
contact the node; this can be an IP address or a DNS name of the host you wish
to contact. In clusters, there is often a management network interface &mdash;
configure its IP address here.
</p>
<div class="note">
In older versions of synctool, <span class="system">ipaddress</span> was
called <span class="system">interface</span>.
The <span class="system">interface</span> keyword still works, but is
discouraged because it really is an IP address and not a network interface.
</div>

<p>
It is good practice to label your master node as &lsquo;master&rsquo; or
&lsquo;install&rsquo;.
<pre class="example">
node n1 master ipaddress:machine-n01
</pre>
Now <span class="system">n1</span> responds to the groups
<span class="system">n1</span> and <span class="system">master</span>.
</p>

<p>
Some people don't like managing the master node itself with synctool.
While it <em>is</em> possible and perfectly alright to do this, some like to
exclude the master node by default:
<pre class="example">
ignore_node n1
</pre>
You have to list each and every host.
In the <span class="path">contrib/</span> directory, there is a script that
uses <span class="cmd">nmap ping</span> with which you can scan your management
network and quickly turn it into a synctool configuration. This makes life
a bit easier.
</p>

<p>
Nodes can be in as many different groups as you like. You can split
long lines of node definitions by ending them with a backslash:
<pre class="example">
node n101 workernode debian plasma mathworks solar \
          fsmounted backup ipaddress:if0-n101
</pre>
<div class="note">
Mind that in practice, synctool repositories are generally easiest
maintainable with as few groups as possible. Make sure to use
logical names for logical groups, and use a top-down group structure.
Make things easy on yourself.
</div>
</p>

<p>
If you have many nodes that all share the same long list of groups,
the groups may be abbreviated by defining a <em>compound</em> group. This
compound group must be defined before defining the nodes:
<pre class="example">
group wn workernode debian plasma mathworks solar \
         fsmounted backup

node 101 wn ipaddress:if0-n101
</pre>
<h3 id="testing_with_dsh">Testing with dsh</h3>
After filling in a couple of nodes in <span class="path">synctool.conf</span>,
try the command <span class="cmd">dsh-ping</span> to see if the nodes are
&lsquo;up&rsquo;. If they are, try <span class="cmd">dsh hostname</span>,
<span class="cmd">dsh uptime</span>, or <span class="cmd">dsh date</span>.
If you correctly set up passwordless SSH, <span class="cmd">dsh</span> should
run the commands on every node without problems or needed manual intervention.
It is important that this works, before proceeding.
<div class="note">
Some (mostly IBM) systems already have a <span class="cmd">dsh</span> command.
In synctool, <span class="cmd">dsh</span> is a symbolic link to
<span class="cmd">synctool-ssh</span>. The same goes for
<span class="cmd">dcp</span>, which is a symlink to
<span class="cmd">synctool-scp</span>.
</div>
</p>

<p>
<h3 id="your_first_synctool_run">Your first synctool run</h3>
Now that you have a rough setup on the master node, try running
synctool to a single node:
<pre class="example">
synctool -n anodename
</pre>
If you get <span class="system">command not found</span>, add
<span class="path">/opt/synctool/sbin</span> to your
<span class="system">PATH</span> environment variable.
By default, the full path to the command is:
<pre class="example">
/opt/synctool/sbin/synctool -n anodename
</pre>
There should be some output message saying <span class="system">DRY RUN</span>.
This means that synctool is now working. You can try running synctool across
all nodes:
<pre class="example">
synctool
</pre>
Check that every node responds. If it doesn't, go back to the step where
we tested the setup using <span class="cmd">dsh</span>.
When synctool to every node works, the basic setup is done and
you can start filling your repository with useful files.
</p>

<p>
<h3 id="client_install">Client installation</h3>
As you may have noticed, we never installed any client software on the nodes.
There is no client installation step; the master node automatically
updates synctool on the client nodes. The binaries needed for this are
located under <span class="path">/var/lib/synctool/sbin/</span>, and this
directory gets synced to the nodes with <span class="cmd">rsync</span>.
</p>

</div>

<div class="vtab"> </div>
<div class="line"> </div>

<p>
<h2 id="part_three">3. Using synctool</h2>
<div class="chapter">
<div class="note">
In synctool terminology, a &ldquo;node&rdquo; is a host, a computer in a group
of computers. A group of computers is called a cluster.
</div>
The main power of synctool is the fact that you can define logical groups,
and you can add these to a filename as a filename extension. This will result
in the file being copied, only if the node belongs to the same group.
The groups a node is in, are defined in the
<span class="path">synctool.conf</span> file.
In the configuration file, the nodename is associated with one or more groups.
The nodename itself can also be used as a group to indicate that a file
belongs to that node.
</p>

<p>
<h3 id="#masterdir">The masterdir</h3>
Once you've installed and setup synctool, you will have a
<span class="system">masterdir</span> repository on the master node of your
cluster. This <span class="system">masterdir</span> is configured in the
<span class="path">synctool.conf</span> file, and is by default set to
<span class="path">/var/lib/synctool</span>.
</p>

<p>
synctool is usually run from the master node. It will use
<span class="cmd">rsync</span> to mirror the
<span class="system">masterdir</span> to all the nodes in the cluster.
If you do have the luxury of a high performance shared filesystem on your
cluster, you may put the masterdir on there and use the option
<span class="system">--skip-rsync</span> to skip the mirroring of the
repository.<br />
Note that it is perfectly possible to run <span class="cmd">synctool.py</span>
&lsquo;stand alone&rsquo; on a node, in which case it will check its local
copy of the repository. It will not synchronize with the master repository,
since it all works with <em>server push</em> and not client pull.
</p>

<p>
In the synctool masterdir there are by default five subdirectories, each having
its own function:
<pre class="example">
* overlay/
* delete/
* scripts/
* tasks/
* sbin/
</pre>
The <span class="path">overlay/</span> tree contains files that have to be
copied. When synctool detects a difference between a file on the system and a
file in the overlay tree, the file will be copied from the
<span class="path">overlay</span> tree onto the system.
</p>

<p>
The <span class="path">delete/</span> tree contains files that always have to
be deleted from the system. Only the filename matters, so it is alright if the
files in this tree are only <span class="system">0</span> bytes in size.
</p>

<p>
The executables in the <span class="path">scripts/</span> directory are
executables that synctool can run when needed. By means of the
<span class="system">on_update</span> directive in the
<span class="path">synctool.conf</span> file, a designated script may be
executed when a certain file is changed.
For example: when <span class="path">/etc/inetd.conf</span> is updated,
the script <span class="cmd">hupdaemon.sh inetd</span> must be run.
</p>

<p>
The executables in de <span class="path">tasks/</span> directory are run when
synctool is invoked with the <span class="system">-t</span> or
<span class="system">--tasks</span> argument.
This makes it possible to run scripts on hosts, which is very convenient for
doing change management.
</p>

<p>
The <span class="path">sbin/</span> directory contains the synctool programs.
Isn't this an odd place to put binaries? Yes, but these are the
&lsquo;master copies&rsquo; of the synctool software. These are also synced
to every node so that synctool can run there.
</p>

<p>
<h3 id="running_synctool">Running synctool</h3>
For example:
<pre class="example">
root@masternode:/# synctool -qf
node3: /etc/xinetd.d/identd updated (file size mismatch)
</pre>
The file is being updated because there is a mismatch in the file size.
Should the file size be the same, synctool will calculate an MD5 checksum to
see whether the file was changed or not.
</p>

<p>
By default synctool does a <em>dry run</em>. It will not do anything but show
what would happen if this would not be a dry run.
Use <span class="system">-f</span> or <span class="system">--fix</span>
to apply any changes.
</p>

<p>
<h3 id="adding_actions_to_updates">Adding actions to updates</h3>
Now I would like the <span class="cmd">xinetd</span> to be automatically
reloaded after I change the <span class="path">identd</span> file.
There are two ways to do this in synctool:
<ol>
<li>Old, classic way; Put in <span class="path">synctool.conf</span>:
<pre class="example">
on_update  /etc/xinetd.d/identd    /etc/init.d/xinetd reload
</pre>
</li>
<li>Modern way, much easier; Put in file
    <span class="path">$masterdir/overlay/etc/xinetd.d/identd.post</span>:
<pre class="example">
/etc/init.d/xinetd reload
</pre>
Use <span class="cmd">chmod</span> to make the 
<span class="system">.post</span> script executable as you would do with any
other shell script. The <span class="system">.post</span> script will be run
when the file changes:
<pre class="example">
root@masternode:/# synctool -qf
node3: /etc/xinetd.d/identd updated (file size mismatch)
node3: running command $masterdir/overlay/etc/xinetd.d/identd.post
</pre>
</li>
</ol>
The <span class="system">.post</span> script is executed in the directory
where the accompanying file is in, in this case
<span class="path">/etc/xinetd.d</span>. It is possible to add a group
extension to the <span class="system">.post</span> script, so that you can
have one group of nodes perform different actions than another.
</p>

<p>
The example for <span class="path">/etc/xinetd.d</span> is interesting because
you can also put an <span class="system">on_update</span> trigger or
<span class="system">.post</span> script on the directory itself.
Whenever a file in the directory gets modified, that trigger will be called.
So, we can simplify the situation for <span class="path">/etc/xinetd.d</span>
to:
<pre class="example">
on_update   /etc/xinetd.d    /etc/init.d/xinetd reload
</pre>
or <span class="path">$masterdir/overlay/etc/xinetd.d.post</span>:
<pre class="example">
/etc/init.d/xinetd reload
</pre>
</p>

<p>
<h3 id="special_groups">Special groups</h3>
The next example shows that the nodename can be used as a group.
In the example, the <span class="path">fstab</span> file is identical
throughout the cluster, with the exception of node5 and node7.
<pre class="example">
root@masternode:/# ls -F /var/lib/synctool/overlay/etc
fstab._all      motd.production._batch   sudoers._all
fstab._node5    nsswitch.conf._all       sysconfig/
fstab._node7    nsswitch.conf.old._all   sysctl.conf._all
</pre>
Group <span class="system">all</span> implictly applies to all nodes.
Likewise, there is an implicit group <span class="system">none</span> that
applies to no nodes. Group <span class="system">none</span> can be
convenient when you to have a copy of a file around, but do not wish to push
it to any nodes yet.
</p>

<p>
<h3 id="useful_options">Useful options</h3>
The <span class="system">-q</span> option of synctool gives less output:
<pre class="example">
root@masternode:/# synctool -q
node3: /etc/xinetd.d/identd updated (file size mismatch)
node3: running command /bin/rm /etc/xinetd.d/*.saved ;
/etc/init.d/xinetd reload
</pre>
If <span class="system">-q</span> still gives too much output, because you
have many nodes in your cluster, it is possible to specify
<span class="system">-a</span> to condense (aggregate) output. The condensed
output groups together output that is the same for many nodes.<br />
<span class="cmd">synctool -qa</span> is one of my favorite commands.
synctool does this by piping the output through the
<span class="cmd">synctool-aggr</span> command. You may also use this to
condense output from <span class="cmd">dsh</span>, for example
<pre class="example">
# dsh date | synctool-aggr
</pre>
or just
<pre class="example">
# dsh -a date

# dsh-ping -a
</pre>
The <span class="system">-f</span> or <span class="system">--fix</span> option
applies all changes. Always be sure to run synctool
at least once as a dry run! (without <span class="system">-f</span>).
Mind that synctool does not lock the repository and does not guard against
concurrent use by multiple sysadmins at once. In practice, this hardly ever
leads to any problems.
</p>

<p>
To update only a single file rather than all files, use the option
<span class="system">--single</span> or <span class="system">-1</span>
(that's a number one, not the letter ell).
</p>

<p>
If you want to check what file synctool is using for a given destination
file, use the <span class="system">-r</span> or
<span class="system">--ref</span> option:
<pre class="example">
root@masternode:/# synctool -q -n node1 -r /etc/resolv.conf
node1: /etc/resolv.conf._somegroup
</pre>
To inspect differences between the master copy and the client copy of a file,
use <span class="system">--diff</span> or <span class="system">-d</span>.
</p>

<p>
synctool can be run on a subset of nodes, a group, or even on individual
nodes using the options <span class="system">--group</span> or
<span class="system">-g</span>, <span class="system">--node</span>
or <span class="system">-n</span>, <span class="system">--exclude</span>
or <span class="system">-x</span>, and <span class="system">--exclude-group</span>
or <span class="system">-X</span>. This also works for
<span class="cmd">dsh</span> and <span class="cmd">dcp</span>, as well as
<span class="cmd">dsh-ping</span>. For example:
<pre class="example">
# synctool -g batch,sched -X rack8
</pre>
Another example:
<pre class="example">
# dsh -n node1,node2,node3 date
</pre>
or copy a file to these three nodes:
<pre class="example">
# dcp -n node1,node2,node3 -d /tmp patchfile-1.0.tar.gz
</pre>
You may also wish to pull a file from a node into the repository. You can do
this from the masternode like this:
<pre class="example">
# synctool -n node1 --upload /path/to/file
</pre>
It may be desirable to give the file a different group extension than the
default proposed by synctool:
<pre class="example">
# synctool -n node1 --upload /path/to/file --suffix=somegroup
</pre>
After rebooting a cluster, use dsh-ping to see if the nodes respond to ping
yet. You may also do this on a group of nodes:
<pre class="example">
# dsh-ping -g rack4
</pre>
The <span class="system">-t</span> or <span class="system">--tasks</span>
option runs the de executables that are in <span class="path">tasks/</span>
(if you also supply <span class="system">-f</span>..!)
These executables can also have group names as filename extension.
They can be shell scripts or any other kind of executables.
This option is particularly useful for making system changes
that cannot be done easily by replacing a configuration file, like for
example installing new software packages. Mind to always include a check to
see whether the system change has already been made, or else it will always
keep installing the same software when it was already there. Doing system
changes through the tasks mechanism is recommended for two reasons:
<ul>
<li>It is easy to see what changes are being done; all tasks are in
    <span class="system">tasks/</span></li>
<li>Whenever a node is down, it can do the updates later to get back in sync
    </li>
</ul>
By default, <span class="system">--tasks</span> is not being run.
You have to explicitly specify this argument to run tasks.
</p>

<p>
The <span class="system">-v</span> option gives verbose output.
This is another way of displaying the logic that synctool performs:
<pre class="example">
# synctool -v
node3: checking $masterdir/overlay/etc/tcpd_banner.production._all
node3: overridden by $masterdir/overlay/etc/tcpd_banner.production._batch
node3: checking $masterdir/overlay/etc/issue.net.production._all
node3: checking $masterdir/overlay/etc/syslog.conf._all
node3: checking $masterdir/overlay/etc/issue.production._all
node3: checking $masterdir/overlay/etc/modules.conf._all
node3: checking $masterdir/overlay/etc/hosts.allow.production._interactive
node3: skipping $masterdir/overlay/etc/hosts.allow.production._interactive,
it is not one of my groups
</pre>
The <span class="system">--unix</span> option produces
<span class="smallcaps">UNIX</span>-style output.
This shows in standard shell syntax just what synctool is about to do.
<pre class="example">
root@masternode:/# synctool --unix
node3: # updating file /etc/xinetd.d/identd
node3: mv /etc/xinetd.d/identd /etc/xinetd.d/identd.saved
node3: umask 077
node3: cp /var/lib/synctool/overlay/etc/xinetd.d/identd._all /etc/xinetd.d/identd
node3: chown root.root /etc/xinetd.d/identd
node3: chmod 0644 /etc/xinetd.d/identd
node3:
node3: # run command /bin/rm /etc/xinetd.d/*.saved ; /etc/init.d/xinetd reload
node3: /bin/rm /etc/xinetd.d/*.saved ; /etc/init.d/xinetd reload
</pre>
<div class="note">
synctool does not apply changes by executing shell commands; all
operations are programmed in Python. The <span class="system">--unix</span>
option is only a way of displaying what synctool does, and may be useful
when debugging.
</div>
The <span class="system">--skip-rsync</span> option skips the
<span class="cmd">rsync</span> run that copies the repository from the master
server to the client node. You should only specify this
option when your repository resides on a shared filesystem. Sharing the
repository between your master server and client nodes has certain security
implications, so be mindful of what you are doing in such a setup.
If you have a fast shared filesystem between all client nodes, but it is
not shared with the master server, you may want to write a wrapper script
around synctool that first runs <span class="cmd">rsync</span> to a
single node to update the shared repository, and then run synctool with
the <span class="system">--skip-rsync</span> option.
</p>

<p>
<h3 id="logging">Logging</h3>
When using <span class="system">--fix</span> to apply changes, synctool can
log the performed actions in a log file.
Use the <span class="system">logfile</span> directive in
<span class="path">synctool.conf</span> to specify that you want logging:
<pre class="example">
logfile /var/log/synctool.log
</pre>
synctool will write this logfile on each node seperately, and a concatenated
log on the master node.
</p>

<p>
<h3 id="ignoring">Ignoring them: I'm not touching you</h3>
By using directives in the <span class="path">synctool.conf</span> file,
synctool can be told to ignore certain files, nodes, or groups.
These will be excluded, skipped. For example:
<pre class="example">
ignore_dotfiles no
ignore_dotdirs yes
ignore .svn
ignore .gitignore
ignore_node node1 node2
ignore_group oldgroup
ignore_group test
</pre>
</p>

<p>
<h3 id="about_symlinks">About symbolic links</h3>
On the Linux operating system, symbolic links always have mode 0777
(shown in the directory as mode <span class="system">lrwxrwxrwx</span>).
This is awkward, because this mode seems to imply that owners, group members,
and others have write access to the symbolic link &mdash;
which is not the case. This results in synctool complaining about the mode
of the symbolic link:
<pre class="example">
/path/subdir/symlink should have mode 0755 (symlink), but has 0777
</pre>
As a workaround, synctool forces the mode of the symbolic link to what
you set it to in <span class="system">synctool.conf</span>.
The hardcoded default value is 0755. Linux users should configure the
value 0777 in <span class="system">synctool.conf</span>:
<pre class="example">
# Linux
symlink_mode 0777
</pre>
<pre class="example">
# sensible mode for most other UNIX systems
symlink_mode 0755
</pre>
<div class="note">
<em>unix.com</em> says about this:
<p>
&ldquo;The permission settings on a symbolic link are a little special
[as well]. They are completely ignored. Many versions of Unix have no way to
change them.&rdquo;
</p>
</div>
As synctool requires all files in the repository to have an extension,
symbolic links must have extensions too. Symbolic links in the repository
will be <em>dead</em> symlinks but they will point to the correct destination
on the target node.
Consider the following example, where <span class="system">file</span> does
not exist &lsquo;as is&rsquo; in the repository:
<pre class="example">
$masterdir/overlay/etc/motd._red -&gt; file
$masterdir/overlay/etc/file._red
</pre>
<h3 id="backup_copies">Backup copies</h3>
For any file synctool updates, it keeps a backup copy around on the target
node with the extension <span class="system">.saved</span>. If you don't
like this, you can tell synctool to not make any backup copies with:
<pre class="example">
backup_copies no
</pre>
It is however highly recommended that you run with
<span class="system">backup_copies</span> enabled.
You can manually specify that you want to remove all backup copies using
<span class="cmd">synctool -e</span> or
<span class="cmd">synctool --erase-saved</span>.
</p>

<p>
<h3 id="local_config">Node-specific local configuration adjustments</h3>
The settings in <span class="path">synctool.conf</span> can be overridden
locally by including a second config file that is present on the node.
</p>

<p>
<span class="system">synctool.conf</span>:
<pre class="example">
include /etc/synctool_local.conf
</pre>
The local config file may contain the same directives as the master config
file, but apply only to the node on which the file resides. The local config
file may be managed from the master repository, enabling you to have subtle
differences in the synctool configuration for certain nodes. For example,
this can be used to change the <span class="system">symlink_mode</span>
in heterogeneous clusters.
Beware that the local config file is read upon startup and may be synced
afterwards, if the file was changed.<br />
Mind that including node specific configs increases the complexity of your
overall synctool configuration, so in general it is recommended that you
stick to using the master <span class="path">synctool.conf</span> only,
and not including any local configs at all.
</p>

<p>
The <span class="system">include</span> keyword can also be used to
clean up your config a little, for example:
<pre class="example">
include /var/lib/synctool/nodes.conf
include /var/lib/synctool/colors.conf
include /var/lib/synctool/on_update.conf
</pre>
In this example all the nodes get the same config, because the masterdir
<span class="path">/var/lib/synctool/</span> is synced to all nodes.
</p>

<p>
<h3 id="checking_for_updates">Checking for updates</h3>
synctool can check whether a new version of synctool itself is available by
using the <span class="system">--check-update</span> option on the master node.
You can check periodically for updates by using
<span class="system">--check-update</span> in a crontab entry.
To download the latest version, run <span class="cmd">synctool --download</span>
on the master node. These functions connect to the main website at
<a href="http://www.heiho.net/synctool/">http://www.heiho.net/synctool</a>.
</p>

</div>

<div class="vtab"> </div>
<div class="line"> </div>

<h2 id="part_four">4. All configuration parameters explained</h2>
<div class="chapter">
This chapter lists and explains all parameters that you can use in
synctool's configuration file.

<dl>
<dt>masterdir &lt;directory&gt;</dt>
<dd>Directory that is the base path to the repository. The default value is
<span class="path">/var/lib/synctool</span>. The order of the statements in
the <span class="path">synctool.conf</span> file is generally not important,
but if you want to use the <span class="system">$masterdir</span> macro in
the config file, you must define <span class="system">masterdir</span> first.
</dd>

<dt>overlaydir &lt;directory&gt;</dt>
<dd>Directory containing files and directories that are to be synced to
the nodes. Default value is <span class="system">$masterdir/overlay/</span>.
Multiple <span class="system">overlaydir</span> declarations are allowed,
and all overlays will be &lsquo;merged&rsquo; together on the target nodes.
Example:
<pre class="example">
overlaydir $masterdir/overlay/common
overlaydir $masterdir/overlay/software
overlaydir $masterdir/overlay/patches
</pre>
Note that this is just an example of how multiple overlays can be used.
Overall, it is probably easier to start with just one single overlay directory.
</dd>

<dt>deletedir &lt;directory&gt;</dt>
<dd>Directory containing files that are to be deleted from the target nodes.
Default value is <span class="system">$masterdir/delete/</span>.
Multiple <span class="system">deletedir</span> declarations are allowed.</dd>

<dt>tasksdir &lt;directory&gt;</dt>
<dd>Directory containing executables (scripts) that are to be run on
the target nodes when <span class="cmd">synctool --tasks</span> is run.
Default value is <span class="system">$masterdir/tasks/</span>.
Multiple <span class="system">tasksdir</span> declarations are allowed.</dd>

<dt>scriptdir &lt;directory&gt;</dt>
<dd>Directory containing scripts that synctool may run through
<span class="system">on_update</span> statements. If you do not use a full
path there, synctool will look in the <span class="path">scriptdir</span>.
Default value is <span class="path">$masterdir/scriptdir</span>. There may
be only one <span class="system">scriptdir</span> defined.
</dd>

<dt>symlink_mode &lt;octal number&gt;</dt>
<dd>Specifies the <span class="smallcaps">UNIX</span> file mode for symbolic
links. This value is an octal number. Default value is
<span class="system">0755</span> and should do for most platforms.
For Linux, set this value to <span class="system">0777</span>.
</dd>

<dt>require_extension &lt;yes/no&gt;</dt>
<dd>When set to &ldquo;yes,&rdquo; a generic file in the
repository must have the extension <span class="system">.all</span>.
When set to &ldquo;no,&rdquo; an extension is not required and the group
<span class="system">all</span> is automatically implied. Default value is
<span class="system">yes</span>.
</dd>

<dt>backup_copies &lt;yes/no&gt;</dt>
<dd>When set to &ldquo;yes,&rdquo; synctool creates backup copies on the
target nodes of files that it updates. These backup files will be named
<span class="path">*.saved</span>.
Default value for this parameter is <span class="system">yes</span>.
</dd>

<dt>ignore_dotfiles &lt;yes/no&gt;</dt>
<dd>Setting this to &ldquo;yes&rdquo; results in synctool ignoring all
files in the repository that begin with a dot. This can be convenient like
for example for <span class="path">.bashrc</span> and
<span class="path">.gitignore</span>.
Default value is <span class="system">no</span>.
</dd>

<dt>ignore_dotdirs &lt;yes/no&gt;</dt>
<dd>Setting this to &ldquo;yes&rdquo; results in synctool ignoring all
directories in the repository that begin with a dot. This can be convenient
like for example for <span class="path">.svn/</span>.
Default value is <span class="system">no</span>.
</dd>

<dt>ignore &lt;filename or directory name&gt;</dt>
<dd>This parameter enables you to have synctool ignore specific files or
directories in the repository.
Multiple <span class="system">ignore</span> definitions are allowed.<br />
There is no default value. Example:
<pre class="example">
ignore .gitignore
ignore .git
ignore .svn
</pre>
</dd>

<dt>logfile &lt;filename&gt;</dt>
<dd>Have synctool log any updates to file. Nothing is logged for dry runs.
By default, no logfile is specified. Example:
<pre class="example">
logfile /var/log/synctool.log
</pre>
</dd>

<dt>diff_cmd &lt;diff UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">diff</span>.
&nbsp; synctool runs this command when you use the <span class="system">--diff</span>
option.  The exact location and arguments of the <span class="cmd">diff</span>
command are operating system specific.
There is no default, but synctool ships with the following in the
example configuration file:
<pre class="example">
diff_cmd /usr/bin/diff -u
</pre>
</dd>

<dt>ping_cmd &lt;ping UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">ping</span>.
&nbsp; <span class="cmd">dsh-ping</span> uses this command to check what nodes
are responding. The exact location and arguments of the <span class="cmd">ping</span>
command are operating system specific.
There is no default, but synctool ships with the following in the example
configuration file:
<pre class="example">
ping_cmd /bin/ping -q -c 2 -t 4
</pre>
</dd>

<dt>ssh_cmd &lt;ssh UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">ssh</span>.
&nbsp; synctool and <span class="cmd">dsh</span> use this command to execute
remote commands on the target nodes.
The exact location of the <span class="cmd">ssh</span> command is operating
system specific.
There is no default, and you must configure this parameter correctly for
synctool to work. synctool ships with the following sensible setting in the
example configuration file:
<pre class="example">
/usr/bin/ssh -o ConnectTimeout=10 -q
</pre>
</dd>

<dt>scp_cmd &lt;scp UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">scp</span>.
&nbsp; <span class="cmd">dcp</span> uses this command to do a remote copy
of files to the target nodes.
The exact location of the <span class="cmd">scp</span> command is operating
system specific.
There is no default, but synctool ships with the following in the example
configuration file:
<pre class="example">
/usr/bin/scp -o ConnectTimeout=10 -p
</pre>
</dd>

<dt>rsync_cmd &lt;rsync UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">rsync</span>.
&nbsp; synctool uses this command to distribute the repository to the target
nodes. The exact location of the <span class="cmd">rsync</span> command is
operating system specific. Unless you keep the repository in a high performance
shared filesystem, you must configure this parameter correctly for synctool
to work.
There is no default, but synctool ships with the following in the example
configuration file:
<pre class="example">
/usr/bin/rsync -ar --delete -e 'ssh -o ConnectTimeout=10 -q'
</pre>
</dd>

<dt>synctool_cmd &lt;synctool UNIX command&gt;</dt>
<dd>Give the full path and arguments to execute <span class="cmd">synctool.py</span>.
&nbsp; This is needed because synctool executes <span class="cmd">synctool.py</span>
on the target nodes.
The exact location of the <span class="cmd">synctool.py</span> command is
installation dependent.
There is no default, and you must configure this parameter correctly for
synctool to work. synctool ships with the following sensible setting in the
example configuration file:
<pre class="example">
synctool_cmd $masterdir/sbin/synctool.py -c $masterdir/synctool.conf
</pre>
</dd>

<dt>num_proc &lt;number&gt;</dt>
<dd>This specifies the maximum amount of parallel processes that synctool
will use. For large clusters, you will want to increase this value, but mind
that this will increase the load on your master node. Setting this value higher
than the amount of nodes you have, has no effect.
The default hardcoded value is <span class="system">16</span>.
</dd>

<dt>full_path &lt;yes/no&gt;</dt>
<dd>synctool likes to abbreviate paths to <span class="path">$masterdir/overlay/some/dir/file</span>.
When you set this option to &ldquo;no, &rdquo; synctool will display the true
full path instead of the abbreviated one.
Default value is <span class="system">no</span>.
</dd>

<dt>terse &lt;yes/no&gt;</dt>
<dd>In terse mode, synctool shows a very brief output with paths abbreviated
to <span class="path">//overlay/dir/.../file</span>.
Default value is <span class="system">no</span>.
</dd>

<dt>colorize &lt;yes/no&gt;</dt>
<dd>In terse mode, synctool output can be made to show colors. Mind that this
parameter only works when <span class="system">terse</span> is set to
<span class="system">yes</span>.
Default value is <span class="system">yes</span>.
</dd>

<dt>colorize_full_line &lt;yes/no&gt;</dt>
<dd>In terse mode, synctool output can be made to show colors. This option
colors the full output line rather than just the leading keyword.
Mind that this parameter only works when both <span class="system">terse</span>
and <span class="system">colorize</span> are enabled.
Default value is <span class="system">no</span>.
</dd>

<dt>colorize_bright &lt;yes/no&gt;</dt>
<dd>In terse mode, synctool output can be made to show colors. This option
enables the bright/bold attribute for colors.
Mind that this parameter only works when both <span class="system">terse</span>
and <span class="system">colorize</span> are enabled.
Default value is <span class="system">yes</span>.
</dd>

<dt>colorize_bold &lt;yes/no&gt;</dt>
<dd>Same as <span class="system">colorize_bright</span>.</dt>

<div class="note">
Following are keywords to customize colors. Valid color codes are:
<span class="system">default</span>, <span class="system">bold</span>,
<span class="system">white</span>, <span class="system">black</span>,
<span class="system">darkgray</span>, <span class="system">red</span>,
<span class="system">green</span>, <span class="system">yellow</span>,
<span class="system">blue</span>, <span class="system">magenta</span>,
and <span class="system">cyan</span>.
</div>

<dt>color_info &lt;color&gt;</dt>
<dd>Specify the color for informational messages in terse mode.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>color_warn &lt;color&gt;</dt>
<dd>Specify the color for warnings in terse mode.<br />
Default value is <span class="system">magenta</span>.
</dd>

<dt>color_error &lt;color&gt;</dt>
<dd>Specify the color for error messages in terse mode.<br />
Default value is <span class="system">red</span>.
</dd>

<dt>color_fail &lt;color&gt;</dt>
<dd>Specify the color for failure messages in terse mode.<br />
Default value is <span class="system">red</span>.
</dd>

<dt>color_sync &lt;color&gt;</dt>
<dd>Specify the color for <em>sync</em> messages in terse mode. These occur
when synctool synchronizes file data.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>color_link &lt;color&gt;</dt>
<dd>Specify the color for <em>link</em> messages in terse mode. These occur
when synctool creates or repairs a symbolic link.<br />
Default value is <span class="system">cyan</span>.
</dd>

<dt>color_mkdir &lt;color&gt;</dt>
<dd>Specify the color for <em>mkdir</em> messages in terse mode. These occur
when synctool creates a driectory.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>color_rm &lt;color&gt;</dt>
<dd>Specify the color for <em>rm</em> messages in terse mode. These occur when
synctool deletes a file.<br />
Default value is <span class="system">yellow</span>.
</dd>

<dt>color_chown &lt;color&gt;</dt>
<dd>Specify the color for <em>chown</em> messages in terse mode. These occur
when synctool changes the ownership of a file or directory.<br />
Default value is <span class="system">cyan</span>.
</dd>

<dt>color_chmod &lt;color&gt;</dt>
<dd>Specify the color for <em>chmod</em> messages in terse mode. These occur
when synctool changes the access mode of a file or directory.<br />
Default value is <span class="system">cyan</span>.
</dd>

<dt>color_exec &lt;color&gt;</dt>
<dd>Specify the color for <em>exec</em> messages in terse mode. These occur
when synctool executes a <span class="system">.post</span> script or
<span class="system">on_update</span> command.<br />
Default value is <span class="system">green</span>.
</dd>

<dt>color_upload &lt;color&gt;</dt>
<dd>Specify the color for <em>upload</em> messages in terse mode. These occur
when use synctool to upload a file.<br />
Default value is <span class="system">magenta</span>.
</dd>

<dt>color_new &lt;color&gt;</dt>
<dd>Specify the color for <em>new</em> messages in terse mode. These occur when
a sync operation requires synctool to create a new file.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>color_type &lt;color&gt;</dt>
<dd>Specify the color for <em>type</em> messages in terse mode. These occur
when the file type of the entry in the repository does not match the file type
of the target file.<br />
Default value is <span class="system">magenta</span>.
</dd>

<dt>color_dryrun &lt;color&gt;</dt>
<dd>Specify the color for the &lsquo;DRYRUN&rsquo; message in terse mode.
It occurs when synctool performs a dry run.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>color_fixing &lt;color&gt;</dt>
<dd>Specify the color for the &lsquo;FIXING&rsquo; message in terse mode.
It occurs when synctool is run with the <span class="system">--fix</span>
option.<br />
Default value is <span class="system">default</span>.
</dd>

<dt>group &lt;groupname&gt; &lt;subgroup&gt; [..]</dt>
<dd>
The <span class="system">group</span> keyword defines <em>compound</em>
groups. It is a means to group several subgroups together into a single group.
If the subgroups did not exist yet, they are defined automatically as new,
empty groups.<br />
Example:
<pre class="example">
group wn workernode batch
group test wn
group g1 batch test wn
</pre>
</dd>

<dt>node &lt;nodename&gt; &lt;group&gt; [..] [ipaddress:&lt;IP address&gt;]</dt>
<dd>The <span class="system">node</span> keyword defines what groups a node
is in. Multiple groups may be given. The order of the groups is important;
the left-most group is most important, and the right-most group is least
important. What this means is that if there are files in repository that have
the same base filename, but a different group extension, synctool will pick
the file that has the most important group extension for this node.<br />
Groups can be defined &lsquo;on the fly,&rsquo; there is no need for a group
to exist before it can be used in a node definition.<br />
The <span class="system">ipaddress</span> specifier tells synctool how to
contact the node. This is optional; when omitted, synctool assumes the
nodename can be found in DNS. Note that synctool nodenames need not be same
as DNS names. In older versions of synctool, the
<span class="system">node</span> keyword was named
<span class="system">host</span>, and the
<span class="system">ipaddress</span> specifier was named
<span class="system">interface</span>.<br />
Example:
<pre class="example">
node node0 master

node node1 fs sched rack1 ipaddress:node1-mgmt
node node2 login    rack1 ipaddress:node2-mgmt
node node3 wn       rack1 ipaddress:node3-mgmt
node node4 wn       rack1 ipaddress:node4-mgmt
node node5 wn       rack1 ipaddress:node5-mgmt
node node6 wn       rack1 ipaddress:node6-mgmt
node node7 wn       rack1 ipaddress:node7-mgmt
node node8 test     rack1 ipaddress:node8-mgmt
node node9 batch    rack1 ipaddress:node9-mgmt
</pre>
</dd>

<dt>ignore_node &lt;nodename&gt; [..]</dt>
<dd>This tells synctool to ignore one or more nodes. You can use this if you
want to skip this node for a while for some reason, for example because it
is broken.<br />
In older versions of synctool, <span class="system">ignore_node</span>
was named <span class="system">ignore_host</span>.
</dd>

<dt>ignore_group &lt;group&gt; [..]</dt>
<dd>This tells synctool to ignore one or more groups. You can use this to
temporarily disable the group. This can be particularly useful when doing
software upgrades.
</dd>




</dl>

This part of the documentation has not been completely written yet.
</div>

<div class="vtab"> </div>
<div class="line"> </div>

<h2 id="part_five">5. Best practices</h2>
<div class="chapter">
This part of the documentation has not been completely written yet.
</div>


<div class="vtab"> </div>
<div class="line"> </div>
</div>

</body>
</html>
